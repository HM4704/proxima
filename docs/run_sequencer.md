## Running node with the sequencer

**Sequencer** is all the following:
1. a token holder who choose to run a sequencer program. Sequencer is active participant in the cooperative consensus    
2. a program, which performs sequencer chain building strategy on behalf of the token holder
3. a chain of transactions constantly produced by the sequencer program

In general, token holder can follow any strategy it likes. 
It can access the UTXO tangle and submit sequencer transactions to the network through API.
However, for performance reasons we developed sequencer program as a part of the node. 
By the choice of the node owner, the sequencer can be started and run on the node by enabling it in the node's configuration. 

Each node can even be configured to run several sequencers, however running one sequencer is the most practical approach.

The following are step-by-step instructions how to initialize and start Proxima node with one sequencer on it.

### 1. Start the node as access node
Follow instructions provided in [Running access node](run_access.md).

After node is started and synced with the network, sequencer can be configured and started.

### 2. Create sequencer controller's wallet 
We will need tokens to run a sequencer. The minimum amount of tokens needed to run a sequencer in the testnet is `1/1000` 
of the initial supply, i.e. `1.000.000.000.000` tokens. 

You can create your account with the command `proxi init wallet`. The command will create wallet configuration profile `proxi.yaml`.
It will contain private key and the address of your account. 

Any other token holder can transfer `1.000.001.000.000` tokens to your account with the 
command `proxi node transfer 1000001000000 -t "addressED25519(<your address data>)"`. 

Let's assume we already have at least `1.000.001.000.000` tokens in your account. This can be 
checked with the command `proxi node balance` run in the working directory which contain wallet profile.  

### 3. Create sequencer chain origin
Command `proxi node mkchain 1000000000000` will create output, the sequencer chain origin, with `1000000000000` tokens on it.
`500` tokens will go as tag-along fee to the tag-along sequencer configured in the wallet. 
The remaining `999500` tokens will stay in the `addressED25519(<address data>)`.

You can check your balances with `proxi node balance`. It will show the balance of the chain output controlled
by the private key of the wallet.

### Configure the sequencer
Sequencer is configured in the `sequencers` section of the `proxima.yaml`.
If template of the section wasn't generated by the `proxi init node -s` command, it must be added manually.

* Replace the placeholder `<local_seq_name>` with your given name of the sequencer. Let's say it is `mySeq`
* Run the command `proxi node chains` to display the `chain ID` of the chain origin created in the previous step.
* Copy the `chain ID` of the newly created chain from the terminal output of the previous command
* Replace the placeholder `<sequencer ID hex encoded>` in the  YAML key `sequncers.mySeq.sequencer_id` with the chain 
ID copied in the previous step
* Put private key of your wallet into the YAML key `sequencers.mySeq.controller_key`
* Put value `true` into the key `sequencers.mySeq.enable`

### Run node with the sequencer
Stop the node with `ctrl-C` if necessary. Then start it again. Sequencer will start automatically after approx 10 sec. 

Check the logs to make sure everything is ok.





### 0. Compile
Clone the repository to `<your_dir>/proxima`.

Type `go install` in working directories `<your_dir>/proxima` and `<your_dir>/proxima/proxi`.
This will create executables: `proxima` for the node, and `proxi` for the CLI program for simple wallet and tools.

Run `proxi -h`, `proxi init -h`, `proxi db -h` to check if it works.

Below we assume we use same working directory for all configuration profiles and databases.

### 1. Create sequencer controller's wallet

The following command generates private key from the provided seed and system randomness.
It creates configuration profile file `proxi.yaml` for the `proxi` program:

`proxi init wallet`

The file `proxi.yaml` will be used as a wallet profile which will control genesis.
It contains genesis private key and corresponding controller address.

The wallet profile must be adjusted by replacing placeholder `<own sequencer ID>` with the predefined bootstrap
sequencer ID `af7bedde1fea222230b82d63d5b665ac75afbe4ad3f75999bb3386cf994a6963`.

Please note that key `api.endpoint` must contain valid API endpoint. In the generated file it contains
default value for the single node running on the local machine.
It may require adjustment when running several nodes on the same machine